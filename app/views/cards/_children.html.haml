- is_head_next = false
- tag_name = card.has_child? || is_head || level == 1 ? "h#{level}" : 'p'

=content_tag tag_name, id: "head_#{card.id}" do
  = card_icon card if level==1 || !card.parent_id || card.parent.user_id != card.user_id
  = link_card card

- render partial: 'menu', locals: {level: level, card: card} if false
- if card.has_grandchild? && cookies[:level].to_i > level
  -card.children.each do |child|
    - is_head_next = true if child.has_child?
    = render partial: 'children', locals: {card: child, level: level+1, is_head: is_head_next}
- else
  - if card.children.count <= 1
    -card.children.each do |child|
      %p
        = card_icon(child) if child.user_id != card.user_id
        = link_card(child)
  - else
    %ul
      -card.children.each do |child|
        %li
          = card_icon(child) if child.user_id != card.user_id
          =link_card(child)

